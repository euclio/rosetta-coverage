<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Rust-Rosetta Coverage</title>
    <script src="https://cdn.firebase.com/js/client/2.4.1/firebase.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js" type="text/javascript"></script>
    <script src="http://listjs.com/no-cdn/list.js"></script>
    <link rel="stylesheet" href="vendor/arewewebyet.css" />
  </head>
  <body>
    <div id="tasks">
    </div>
    <script id="tasks-template" type="text/x-handlebars-template">
      <input class="search" placeholder="Search" />
      <input type="radio" name="filter" value="all" checked>All</input>
      <input type="radio" name="filter" value="local">Local Only</input>
      <input type="radio" name="filter" value="remote">Remote Only</input>
      <input type="radio" name="filter" value="unimplemented">Unimplemented</input>
      <table id="tasks">
        <thead>
          <tr>
            <td>Title</td>
            <td>Local</td>
            <td>Remote</td>
          </tr>
        </thead>
        <tbody class="list">
          {{#each this }}
          <tr>
            <td class="title" data-title="{{ this.title }}"><a href="{{ this.url }}">{{ this.title }}</a></td>
            <td class="local done" title="{{#if this.local_code }}Yes{{else}}No{{/if}}">{{#if this.local_code }}<a href="https://github.com/Hoverbear/rust-rosetta/blob/master/{{ this.path }}">✔</a>{{else}}✘{{/if}}</td>
            <td class="remote done" title="{{#if this.remote_code}}Yes{{else}}No{{/if}}">{{#if this.remote_code }}<a href="{{ this.url }}#Rust">✔</a>{{else}}✘{{/if}}</td>
          </tr>
          {{/each}}
        </tbody>
      </table>
    </script>
    <script type="text/javascript">
      var tasksTemplate = Handlebars.compile(document.getElementById('tasks-template').innerText);
      var firebase = new Firebase("https://rosetta-coverage.firebaseio.com/");
      firebase.child("tasks").once("value", function(snapshot) {
        var html = tasksTemplate(snapshot.val());
        document.getElementById('tasks').innerHTML = html;

        var taskList = new List('tasks', {
          valueNames: [
            'name',
            { 'name': 'title', 'attr': 'data-title' },
            { 'name': 'local', 'attr': 'title' },
            { 'name': 'remote', 'attr': 'title' },
          ]
        });

        var radioButtons = document.querySelectorAll('input[type=radio');

        [].forEach.call(radioButtons, function(element) {
          element.addEventListener('click', function(event) {
            taskList.filter();

            var filter = event.srcElement.value;
            taskList.filter(function(item) {
              if (filter === 'local') {
                return item.values().local === 'Yes' && item.values().remote === 'No';
              } else if (filter === 'remote') {
                return item.values().remote === 'Yes' && item.values().local === 'No';
              } else if (filter === 'unimplemented') {
                return item.values().remote === 'No' && item.values().local === 'No';
              }

              return true;
            });
          })
        });
      });
    </script>
  </body>
</html>
